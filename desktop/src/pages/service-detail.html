<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servis Detay - Akƒ±n Kombi</title>
    <link rel="stylesheet" href="nova.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Nova POS Theme - Service Detail */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.05) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
            pointer-events: none;
            z-index: 0;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .detail-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            padding: 35px 50px;
            border-radius: 24px;
            margin-bottom: 35px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.08) inset;
        }
        
        .detail-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, transparent 40%, rgba(139, 92, 246, 0.08) 100%);
            pointer-events: none;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .header-title h1 {
            margin: 0;
            font-size: 36px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .status-pending { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; border: 1px solid #fcd34d; }
        .status-in-progress { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #1e40af; border: 1px solid #93c5fd; }
        .status-completed { background: linear-gradient(135deg, #d1fae5, #a7f3d0); color: #065f46; border: 1px solid #6ee7b7; }
        .status-cancelled { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b; border: 1px solid #fca5a5; }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .btn-back {
            padding: 14px 32px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn-back:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary {
            padding: 14px 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .tab {
            flex: 1;
            padding: 16px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .tab:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .tab-content {
            display: none;
            animation: fadeInUp 0.5s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .info-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.8) inset;
        }
        
        .info-card:hover::before {
            transform: scaleX(1);
        }
        
        .info-card h3 {
            margin: 0 0 20px 0;
            font-size: 20px;
            font-weight: 700;
            color: #1e293b;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #64748b;
            font-weight: 600;
            font-size: 15px;
        }
        
        .info-value {
            color: #1e293b;
            font-weight: 700;
            font-size: 15px;
            text-align: right;
        }
        
        /* Detail Section */
        .detail-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            margin-bottom: 25px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .detail-section:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.8) inset;
        }
        
        .detail-section h3 {
            margin: 0 0 25px 0;
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Parts Table */
        .parts-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .parts-table th {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            padding: 16px;
            text-align: left;
            font-weight: 700;
            color: #475569;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .parts-table td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 15px;
            color: #1e293b;
        }
        
        .parts-table tr:hover {
            background: #f8fafc;
        }
        
        /* Cost Summary */
        .cost-summary {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 30px;
            border-radius: 16px;
            margin-top: 25px;
            border: 2px solid #e2e8f0;
        }
        
        .cost-row {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            font-size: 17px;
            font-weight: 600;
            color: #475569;
        }
        
        .cost-row.total {
            border-top: 3px solid #2563eb;
            margin-top: 15px;
            padding-top: 20px;
            font-size: 24px;
            font-weight: 800;
            color: #2563eb;
        }
        
        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 50px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: 35px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -42px;
            top: 0;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: 4px solid white;
            box-shadow: 0 0 0 3px #3b82f6, 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .timeline-item:after {
            content: '';
            position: absolute;
            left: -33px;
            top: 20px;
            width: 3px;
            height: calc(100% - 20px);
            background: linear-gradient(180deg, #3b82f6, #e2e8f0);
        }
        
        .timeline-item:last-child:after {
            display: none;
        }
        
        .timeline-content {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .timeline-date {
            color: #64748b;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .timeline-title {
            font-weight: 700;
            color: #1e293b;
            font-size: 16px;
            margin-bottom: 6px;
        }
        
        .timeline-desc {
            color: #64748b;
            font-size: 14px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 15px; }
            .detail-header { padding: 25px 30px; }
            .header-content { flex-direction: column; gap: 20px; }
            .header-title h1 { font-size: 28px; }
            .info-grid { grid-template-columns: 1fr; }
            .tabs { flex-direction: column; }
            .detail-section { padding: 25px; }
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.show, .modal[style*="display: flex"] {
            display: flex !important;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 25px 30px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            color: #1e293b;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 32px;
            color: #64748b;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #f1f5f9;
            color: #1e293b;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        .form-row {
            margin-bottom: 20px;
        }
        
        .form-row label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e293b;
            font-size: 15px;
        }
        
        .form-row input,
        .form-row select,
        .form-row textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.2s;
        }
        
        .form-row input:focus,
        .form-row select:focus,
        .form-row textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-row small {
            display: block;
            margin-top: 6px;
            font-size: 13px;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="detail-header">
            <div class="header-content">
                <div class="header-title">
                    <h1>Servis #<span id="serviceId">-</span></h1>
                    <span class="status-badge" id="headerStatus">Y√ºkleniyor...</span>
                </div>
                <div class="header-actions">
                    <button class="btn-back" onclick="window.location.href='services.html'">
                        ‚Üê Geri D√∂n
                    </button>
                    <button class="btn-primary" onclick="editService()" style="background: linear-gradient(135deg, #10b981, #059669);">
                        ‚úèÔ∏è D√ºzenle
                    </button>
                    <button class="btn-primary" onclick="window.print()">
                        üñ®Ô∏è Yazdƒ±r
                    </button>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="info">
                üìã Temel Bilgiler
            </button>
            <button class="tab" data-tab="parts">
                üì¶ Kullanƒ±lan Par√ßalar
            </button>
            <button class="tab" data-tab="payment">
                üí≥ √ñdeme Bilgileri
            </button>
            <button class="tab" data-tab="photos">
                üì∏ Fotoƒüraflar
            </button>
            <button class="tab" data-tab="timeline">
                üìÖ Zaman √áizelgesi
            </button>
        </div>

        <!-- Temel Bilgiler Tab -->
        <div id="tab-info" class="tab-content active">
            <div class="info-grid">
                <div class="info-card">
                    <h3>üë§ M√º≈üteri Bilgileri</h3>
                    <div class="info-item">
                        <span class="info-label">Ad Soyad:</span>
                        <span class="info-value" id="customerName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Telefon:</span>
                        <span class="info-value" id="customerPhone">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">E-posta:</span>
                        <span class="info-value" id="customerEmail">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Adres:</span>
                        <span class="info-value" id="customerAddress">-</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üîß Cihaz Bilgileri</h3>
                    <div class="info-item">
                        <span class="info-label">Cihaz Tipi:</span>
                        <span class="info-value" id="deviceType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Marka:</span>
                        <span class="info-value" id="deviceBrand">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Model:</span>
                        <span class="info-value" id="deviceModel">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Seri No:</span>
                        <span class="info-value" id="deviceSerial">-</span>
                    </div>
                </div>

                <div class="info-card">
                    <h3>üë®‚Äçüîß Servis Bilgileri</h3>
                    <div class="info-item">
                        <span class="info-label">Teknisyen:</span>
                        <span class="info-value" id="technicianName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Servis Tipi:</span>
                        <span class="info-value" id="serviceType">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Durum:</span>
                        <span class="info-value" id="serviceStatus">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tarih:</span>
                        <span class="info-value" id="serviceDate">-</span>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>üìù Servis Detaylarƒ±</h3>
                <div style="margin-bottom: 20px;">
                    <strong>≈ûikayet/Talep:</strong>
                    <p id="serviceDescription" style="color: #64748b; margin: 10px 0;">-</p>
                </div>
                <div style="margin-bottom: 20px;">
                    <strong>Te≈ühis:</strong>
                    <p id="serviceDiagnosis" style="color: #64748b; margin: 10px 0;">-</p>
                </div>
                <div>
                    <strong>Yapƒ±lan ƒ∞≈ülemler:</strong>
                    <p id="serviceWork" style="color: #64748b; margin: 10px 0;">-</p>
                </div>
            </div>
        </div>

        <!-- Kullanƒ±lan Par√ßalar Tab -->
        <div id="tab-parts" class="tab-content">
            <div class="detail-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0;">üì¶ Kullanƒ±lan Par√ßalar</h3>
                    <button class="btn-primary" onclick="openAddPartModal()" style="padding: 12px 24px;">
                        ‚ûï Par√ßa Ekle
                    </button>
                </div>
                <table class="parts-table">
                    <thead>
                        <tr>
                            <th>Par√ßa Adƒ±</th>
                            <th>Miktar</th>
                            <th>Birim Fiyat</th>
                            <th>Toplam</th>
                            <th>Garanti</th>
                            <th style="width: 100px;">ƒ∞≈ülem</th>
                        </tr>
                    </thead>
                    <tbody id="partsTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; color: #64748b;">Par√ßa bilgisi yok</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- √ñdeme Bilgileri Tab -->
        <div id="tab-payment" class="tab-content">
            <div class="detail-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0;">üí∞ Maliyet Hesabƒ±</h3>
                    <button class="btn-primary" onclick="openPaymentModal()" style="padding: 12px 24px;">
                        üí≥ √ñdeme Al
                    </button>
                </div>
                <div class="cost-summary">
                    <div class="cost-row">
                        <span>ƒ∞≈ü√ßilik √úcreti:</span>
                        <span id="laborCost">0 ‚Ç∫</span>
                    </div>
                    <div class="cost-row">
                        <span>Par√ßa Maliyeti:</span>
                        <span id="partsCost">0 ‚Ç∫</span>
                    </div>
                    <div class="cost-row">
                        <span>Yol √úcreti:</span>
                        <span id="travelCost">0 ‚Ç∫</span>
                    </div>
                    <div class="cost-row total">
                        <span>TOPLAM:</span>
                        <span id="totalCost">0 ‚Ç∫</span>
                    </div>
                    <div class="cost-row" style="color: #10b981; font-weight: 700; border-top: 2px solid #d1fae5; margin-top: 10px; padding-top: 10px;">
                        <span>√ñdenen:</span>
                        <span id="paidAmount">0 ‚Ç∫</span>
                    </div>
                    <div class="cost-row" style="color: #ef4444; font-weight: 700;">
                        <span>Kalan Bor√ß:</span>
                        <span id="remainingAmount">0 ‚Ç∫</span>
                    </div>
                </div>
            </div>

            <div class="detail-section">
                <h3>üí≥ √ñdeme Ge√ßmi≈üi</h3>
                <table class="parts-table">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>Tutar</th>
                            <th>Y√∂ntem</th>
                            <th>Durum</th>
                            <th>Not</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; color: #64748b;">√ñdeme kaydƒ± yok</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Zaman √áizelgesi Tab -->
        <div id="tab-timeline" class="tab-content">
            <div class="detail-section">
                <h3>üìÖ Servis Ge√ßmi≈üi</h3>
                <div class="timeline" id="timelineContainer">
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date" id="createdDate">-</div>
                            <div class="timeline-title">Servis Kaydƒ± Olu≈üturuldu</div>
                            <div class="timeline-desc">Servis talebi sisteme girildi</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fotoƒüraflar Tab -->
        <div id="tab-photos" class="tab-content">
            <div class="detail-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0;">üì∏ Fotoƒüraflar ve Belgeler</h3>
                    <button class="btn-primary" onclick="openUploadModal()" style="padding: 12px 24px;">
                        üì§ Dosya Y√ºkle
                    </button>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap;">
                    <button class="btn" onclick="filterPhotos('all')" id="filter-all" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;">
                        T√ºm√º
                    </button>
                    <button class="btn btn-secondary" onclick="filterPhotos('before')" id="filter-before" style="padding: 10px 20px;">
                        üî¥ Servis √ñncesi
                    </button>
                    <button class="btn btn-secondary" onclick="filterPhotos('after')" id="filter-after" style="padding: 10px 20px;">
                        üü¢ Servis Sonrasƒ±
                    </button>
                    <button class="btn btn-secondary" onclick="filterPhotos('part')" id="filter-part" style="padding: 10px 20px;">
                        üì¶ Par√ßa
                    </button>
                    <button class="btn btn-secondary" onclick="filterPhotos('document')" id="filter-document" style="padding: 10px 20px;">
                        üìÑ Belge
                    </button>
                </div>
                
                <div id="photoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
                    <div style="grid-column: 1/-1; text-align: center; color: #64748b; padding: 40px;">
                        Hen√ºz fotoƒüraf y√ºklenmemi≈ü
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal -->
    <div id="custom-confirm-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Onay</h3>
            </div>
            <div class="modal-body">
                <p id="custom-confirm-message" style="font-size: 16px; margin: 20px 0; color: #1e293b;"></p>
                <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" id="custom-confirm-no">Hayƒ±r</button>
                    <button type="button" class="btn btn-primary" id="custom-confirm-yes">Evet</button>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"><span id="notificationMessage"></span></div>
    <div id="loading" class="loading"><div class="spinner"></div></div>

    <script src="app.js"></script>
    <script>
        // Custom Confirm Modal (Electron Best Practice)
        function customConfirm(message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('custom-confirm-modal');
                const messageEl = document.getElementById('custom-confirm-message');
                const yesBtn = document.getElementById('custom-confirm-yes');
                const noBtn = document.getElementById('custom-confirm-no');
                
                messageEl.textContent = message;
                modal.style.display = 'flex';
                document.body.classList.add('modal-open');
                
                const handleYes = () => {
                    cleanup();
                    resolve(true);
                };
                
                const handleNo = () => {
                    cleanup();
                    resolve(false);
                };
                
                const cleanup = () => {
                    modal.style.display = 'none';
                    document.body.classList.remove('modal-open');
                    yesBtn.removeEventListener('click', handleYes);
                    noBtn.removeEventListener('click', handleNo);
                };
                
                yesBtn.addEventListener('click', handleYes);
                noBtn.addEventListener('click', handleNo);
                
                setTimeout(() => yesBtn.focus(), 100);
            });
        }

        let serviceData = null;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
        
        // Tab event listeners
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Sayfa y√ºklendi, tab event listeners ekleniyor...');
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Servis detayƒ±nƒ± y√ºkle
            loadServiceDetail();
        });

        // Get service ID from URL
        function getServiceId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }

        // Load service details
        async function loadServiceDetail() {
            const serviceId = getServiceId();
            console.log('üîç Servis detayƒ± y√ºkleniyor, ID:', serviceId);
            
            if (!serviceId) {
                showNotification('Servis ID bulunamadƒ±', 'error');
                setTimeout(() => window.location.href = 'services.html', 2000);
                return;
            }

            try {
                showLoading();
                
                console.log('üîÑ API √ßaƒürƒ±larƒ± ba≈ülatƒ±lƒ±yor...');
                
                // Load service data
                serviceData = await apiCall(`/services/${serviceId}`);
                console.log('‚úÖ Servis verisi:', serviceData);
                
                // Load related data
                const [customer, device, technician, parts, allPayments, files] = await Promise.all([
                    serviceData.customer_id ? apiCall(`/customers/${serviceData.customer_id}`).catch(() => null) : null,
                    serviceData.device_id ? apiCall(`/devices/${serviceData.device_id}`).catch(() => null) : null,
                    serviceData.technician_id ? apiCall(`/technicians/${serviceData.technician_id}`).catch(() => null) : null,
                    apiCall(`/services/${serviceId}/parts`).catch(() => []),
                    apiCall('/financial/payments').catch(() => []),
                    apiCall(`/services/${serviceId}/files`).catch(() => [])
                ]);

                console.log('‚úÖ ƒ∞li≈ükili veriler y√ºklendi:', { 
                    customer: customer?.first_name, 
                    device: device?.brand, 
                    technician: technician?.first_name,
                    partsCount: parts.length,
                    paymentsCount: allPayments.length,
                    filesCount: files.length
                });

                // Filter payments for this service
                const payments = Array.isArray(allPayments) ? allPayments.filter(p => p.service_id == serviceId) : [];

                // Render data
                renderServiceInfo(serviceData, customer, device, technician);
                renderParts(parts);
                renderPayment(serviceData, payments);
                renderTimeline(serviceData);
                
                // Set photos data
                allPhotos = Array.isArray(files) ? files : [];
                renderPhotos();
                
                console.log('‚úÖ Sayfa render edildi');

            } catch (error) {
                console.error('‚ùå Servis detay hatasƒ±:', error);
                showNotification('Servis bilgileri y√ºklenemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // Render service info
        function renderServiceInfo(service, customer, device, technician) {
            document.getElementById('serviceId').textContent = service.service_id;
            
            // Header status badge
            const statusMap = { pending: 'Beklemede', in_progress: 'Devam Ediyor', completed: 'Tamamlandƒ±', cancelled: 'ƒ∞ptal' };
            const statusClass = `status-${service.status.replace('_', '-')}`;
            document.getElementById('headerStatus').className = `status-badge ${statusClass}`;
            document.getElementById('headerStatus').textContent = statusMap[service.status] || service.status;
            
            // Customer info
            if (customer) {
                document.getElementById('customerName').textContent = `${customer.first_name} ${customer.last_name}`;
                document.getElementById('customerPhone').textContent = customer.phone || '-';
                document.getElementById('customerEmail').textContent = customer.email || '-';
                const address = [customer.neighborhood, customer.district, customer.city].filter(Boolean).join(', ');
                document.getElementById('customerAddress').textContent = address || '-';
            }

            // Device info
            if (device) {
                const deviceTypes = { boiler: 'Kazan', combi: 'Kombi', heater: 'Isƒ±tƒ±cƒ±' };
                document.getElementById('deviceType').textContent = deviceTypes[device.device_type] || device.device_type;
                document.getElementById('deviceBrand').textContent = device.brand || '-';
                document.getElementById('deviceModel').textContent = device.model || '-';
                document.getElementById('deviceSerial').textContent = device.serial_number || '-';
            }

            // Service info
            if (technician) {
                document.getElementById('technicianName').textContent = `${technician.first_name} ${technician.last_name}`;
            }
            
            const serviceTypes = { maintenance: 'Bakƒ±m', repair: 'Onarƒ±m', installation: 'Kurulum' };
            document.getElementById('serviceType').textContent = serviceTypes[service.service_type] || service.service_type;
            
            const statusClass2 = `status-${service.status.replace('_', '-')}`;
            const statusText = { pending: 'Beklemede', in_progress: 'Devam Ediyor', completed: 'Tamamlandƒ±', cancelled: 'ƒ∞ptal' };
            document.getElementById('serviceStatus').innerHTML = `<span class="status-badge ${statusClass2}">${statusText[service.status]}</span>`;
            
            document.getElementById('serviceDate').textContent = new Date(service.scheduled_date).toLocaleDateString('tr-TR');
            
            // Details
            document.getElementById('serviceDescription').textContent = service.problem_description || service.description || 'Belirtilmemi≈ü';
            document.getElementById('serviceDiagnosis').textContent = service.diagnosis || 'Hen√ºz te≈ühis yapƒ±lmadƒ±';
            document.getElementById('serviceWork').textContent = service.work_done || 'Hen√ºz i≈ülem yapƒ±lmadƒ±';
        }

        // Render parts
        function renderParts(parts) {
            const tbody = document.getElementById('partsTableBody');
            
            if (!parts || parts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #64748b;">Hen√ºz par√ßa eklenmemi≈ü</td></tr>';
                document.getElementById('partsCost').textContent = '0 ‚Ç∫';
                return;
            }

            let total = 0;
            tbody.innerHTML = parts.map(part => {
                const partTotal = part.quantity * part.unit_price;
                total += partTotal;
                const warrantyBadge = part.is_warranty ? '<span class="status-badge status-completed" style="font-size: 11px; padding: 4px 8px;">Garanti</span>' : '';
                return `
                    <tr>
                        <td>${part.part_name || part.name || '-'}</td>
                        <td>${part.quantity}</td>
                        <td>${parseFloat(part.unit_price).toFixed(2)} ‚Ç∫</td>
                        <td><strong>${partTotal.toFixed(2)} ‚Ç∫</strong></td>
                        <td>${warrantyBadge}</td>
                        <td>
                            <button class="btn btn-danger" onclick="removePart(${part.service_part_id})" style="padding: 6px 12px; font-size: 13px;">
                                üóëÔ∏è Sil
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('partsCost').textContent = total.toFixed(2) + ' ‚Ç∫';
            updateTotalCost();
        }

        // Render payment
        function renderPayment(service, payments) {
            const laborCost = parseFloat(service.labor_cost) || 0;
            const travelCost = parseFloat(service.travel_cost) || 0;
            const totalCost = parseFloat(service.total_cost) || 0;
            
            document.getElementById('laborCost').textContent = laborCost.toFixed(2) + ' ‚Ç∫';
            document.getElementById('travelCost').textContent = travelCost.toFixed(2) + ' ‚Ç∫';
            document.getElementById('totalCost').textContent = totalCost.toFixed(2) + ' ‚Ç∫';

            // Calculate paid amount
            const paidAmount = payments.reduce((sum, p) => sum + parseFloat(p.amount), 0);
            const remainingAmount = totalCost - paidAmount;
            
            document.getElementById('paidAmount').textContent = paidAmount.toFixed(2) + ' ‚Ç∫';
            document.getElementById('remainingAmount').textContent = remainingAmount.toFixed(2) + ' ‚Ç∫';
            
            // Render payments table
            const tbody = document.getElementById('paymentsTableBody');
            
            if (!payments || payments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #64748b;">Hen√ºz √∂deme alƒ±nmamƒ±≈ü</td></tr>';
                return;
            }
            
            const methods = { cash: 'üíµ Nakit', credit_card: 'üí≥ Kredi Kartƒ±', bank_transfer: 'üè¶ Havale/EFT' };
            
            tbody.innerHTML = payments.map(payment => {
                const statusBadge = payment.status === 'completed' 
                    ? '<span class="status-badge status-completed">Tamamlandƒ±</span>'
                    : '<span class="status-badge status-pending">Beklemede</span>';
                    
                return `
                    <tr>
                        <td>${new Date(payment.payment_date).toLocaleDateString('tr-TR')}</td>
                        <td><strong>${parseFloat(payment.amount).toFixed(2)} ‚Ç∫</strong></td>
                        <td>${methods[payment.payment_method] || payment.payment_method}</td>
                        <td>${statusBadge}</td>
                        <td>${payment.notes || '-'}</td>
                    </tr>
                `;
            }).join('');
            
            allPayments = payments;
        }

        // Update total cost
        function updateTotalCost() {
            const labor = parseFloat(document.getElementById('laborCost').textContent) || 0;
            const parts = parseFloat(document.getElementById('partsCost').textContent) || 0;
            const travel = parseFloat(document.getElementById('travelCost').textContent) || 0;
            const total = labor + parts + travel;
            document.getElementById('totalCost').textContent = total.toFixed(2) + ' ‚Ç∫';
        }

        // Render timeline
        function renderTimeline(service) {
            document.getElementById('createdDate').textContent = new Date(service.created_at).toLocaleString('tr-TR');
            
            const timeline = document.getElementById('timelineContainer');
            let html = `
                <div class="timeline-item">
                    <div class="timeline-content">
                        <div class="timeline-date">${new Date(service.created_at).toLocaleString('tr-TR')}</div>
                        <div class="timeline-title">Servis Kaydƒ± Olu≈üturuldu</div>
                        <div class="timeline-desc">Servis talebi sisteme girildi</div>
                    </div>
                </div>
            `;

            if (service.scheduled_date) {
                html += `
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">${new Date(service.scheduled_date).toLocaleString('tr-TR')}</div>
                            <div class="timeline-title">Randevu Planlandƒ±</div>
                            <div class="timeline-desc">Servis randevusu belirlendi</div>
                        </div>
                    </div>
                `;
            }

            if (service.completion_date) {
                html += `
                    <div class="timeline-item">
                        <div class="timeline-content">
                            <div class="timeline-date">${new Date(service.completion_date).toLocaleString('tr-TR')}</div>
                            <div class="timeline-title">Servis Tamamlandƒ±</div>
                            <div class="timeline-desc">ƒ∞≈ülemler ba≈üarƒ±yla tamamlandƒ±</div>
                        </div>
                    </div>
                `;
            }

            timeline.innerHTML = html;
        }

        // Add Part Modal
        let allParts = [];
        
        async function openAddPartModal() {
            // Load parts list
            try {
                const response = await apiCall('/inventory/parts?active=true');
                allParts = Array.isArray(response) ? response : (response.data || []);
                
                const partsOptions = allParts.map(p => 
                    `<option value="${p.part_id}" data-price="${p.unit_price}">${p.name} - ${p.unit_price} ‚Ç∫</option>`
                ).join('');
                
                const modal = document.createElement('div');
                modal.id = 'addPartModal';
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <div class="modal-header">
                            <h3>‚ûï Par√ßa Ekle</h3>
                            <button class="close-btn" onclick="closeAddPartModal()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <label>Par√ßa Se√ß *</label>
                                <select id="partSelect" onchange="updatePartPrice()" required>
                                    <option value="">Se√ßiniz...</option>
                                    ${partsOptions}
                                </select>
                            </div>
                            <div class="form-row">
                                <label>Miktar *</label>
                                <input type="number" id="partQuantity" min="1" value="1" onchange="updatePartTotal()" required>
                            </div>
                            <div class="form-row">
                                <label>Birim Fiyat (‚Ç∫)</label>
                                <input type="number" id="partPrice" step="0.01" readonly>
                            </div>
                            <div class="form-row">
                                <label>Toplam (‚Ç∫)</label>
                                <input type="number" id="partTotal" step="0.01" readonly>
                            </div>
                            <div class="form-row">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="partWarranty" onchange="updatePartWarranty()">
                                    <span>Garanti Kapsamƒ±nda (√úcretsiz)</span>
                                </label>
                            </div>
                            <div class="form-row">
                                <label>Not</label>
                                <textarea id="partNotes" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="closeAddPartModal()">ƒ∞ptal</button>
                            <button class="btn btn-primary" onclick="addPart()">Ekle</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            } catch (error) {
                showNotification('Par√ßa listesi y√ºklenemedi: ' + error.message, 'error');
            }
        }
        
        function closeAddPartModal() {
            const modal = document.getElementById('addPartModal');
            if (modal) modal.remove();
        }
        
        function updatePartPrice() {
            const select = document.getElementById('partSelect');
            const option = select.options[select.selectedIndex];
            const price = option ? parseFloat(option.dataset.price) || 0 : 0;
            document.getElementById('partPrice').value = price.toFixed(2);
            updatePartTotal();
        }
        
        function updatePartTotal() {
            const quantity = parseInt(document.getElementById('partQuantity').value) || 0;
            const price = parseFloat(document.getElementById('partPrice').value) || 0;
            const isWarranty = document.getElementById('partWarranty').checked;
            const total = isWarranty ? 0 : (quantity * price);
            document.getElementById('partTotal').value = total.toFixed(2);
        }
        
        function updatePartWarranty() {
            updatePartTotal();
        }
        
        async function addPart() {
            const partId = document.getElementById('partSelect').value;
            const quantity = parseInt(document.getElementById('partQuantity').value);
            const isWarranty = document.getElementById('partWarranty').checked;
            const notes = document.getElementById('partNotes').value;
            
            console.log('üì¶ Par√ßa ekleniyor:', { partId, quantity, isWarranty, notes });
            
            if (!partId || !quantity) {
                showNotification('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun', 'error');
                return;
            }
            
            try {
                showLoading();
                const serviceId = getServiceId();
                
                console.log('üîÑ API √ßaƒürƒ±sƒ± yapƒ±lƒ±yor:', `/services/${serviceId}/parts`);
                
                const result = await apiCall(`/services/${serviceId}/parts`, 'POST', {
                    part_id: parseInt(partId),
                    quantity,
                    is_warranty: isWarranty,
                    notes
                });
                
                console.log('‚úÖ Par√ßa eklendi:', result);
                showNotification('Par√ßa ba≈üarƒ±yla eklendi', 'success');
                closeAddPartModal();
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                console.error('‚ùå Par√ßa ekleme hatasƒ±:', error);
                showNotification('Par√ßa eklenemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        async function removePart(servicePartId) {
            const confirmed = await customConfirm('Bu par√ßayƒ± kaldƒ±rmak istediƒüinizden emin misiniz?');
            if (!confirmed) return;
            
            try {
                showLoading();
                
                await apiCall(`/services/parts/${servicePartId}`, 'DELETE');
                
                showNotification('Par√ßa ba≈üarƒ±yla kaldƒ±rƒ±ldƒ±', 'success');
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                showNotification('Par√ßa kaldƒ±rƒ±lamadƒ±: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // Payment Modal
        let allPayments = [];
        let totalServiceCost = 0;
        
        function openPaymentModal() {
            const total = parseFloat(document.getElementById('totalCost').textContent) || 0;
            const paid = parseFloat(document.getElementById('paidAmount').textContent) || 0;
            const remaining = total - paid;
            
            if (remaining <= 0) {
                showNotification('√ñdeme tamamlanmƒ±≈ü, kalan bor√ß yok', 'info');
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'paymentModal';
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>üí≥ √ñdeme Al</h3>
                        <button class="close-btn" onclick="closePaymentModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div style="background: linear-gradient(135deg, #f8fafc, #f1f5f9); padding: 20px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #3b82f6;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #64748b; font-weight: 600;">Toplam Tutar:</span>
                                <span style="color: #1e293b; font-weight: 700; font-size: 18px;">${total.toFixed(2)} ‚Ç∫</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #10b981; font-weight: 600;">√ñdenen:</span>
                                <span style="color: #10b981; font-weight: 700;">${paid.toFixed(2)} ‚Ç∫</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 2px solid #e2e8f0;">
                                <span style="color: #ef4444; font-weight: 700;">Kalan Bor√ß:</span>
                                <span style="color: #ef4444; font-weight: 800; font-size: 20px;">${remaining.toFixed(2)} ‚Ç∫</span>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <label>√ñdeme Tutarƒ± (‚Ç∫) *</label>
                            <input type="number" id="paymentAmount" step="0.01" max="${remaining}" value="${remaining}" required>
                            <small style="color: #64748b;">Maksimum: ${remaining.toFixed(2)} ‚Ç∫</small>
                        </div>
                        <div class="form-row">
                            <label>√ñdeme Y√∂ntemi *</label>
                            <select id="paymentMethodSelect" onchange="toggleTransactionId()" required>
                                <option value="cash">üíµ Nakit</option>
                                <option value="credit_card">üí≥ Kredi Kartƒ±</option>
                                <option value="bank_transfer">üè¶ Havale/EFT</option>
                            </select>
                        </div>
                        <div class="form-row" id="transactionIdRow" style="display: none;">
                            <label>ƒ∞≈ülem Numarasƒ±</label>
                            <input type="text" id="transactionId" placeholder="Kart/Havale i≈ülem numarasƒ±">
                        </div>
                        <div class="form-row">
                            <label>Not</label>
                            <textarea id="paymentNotes" rows="2" placeholder="√ñdeme ile ilgili not..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closePaymentModal()">ƒ∞ptal</button>
                        <button class="btn btn-primary" onclick="addPayment()">√ñdeme Al</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closePaymentModal() {
            const modal = document.getElementById('paymentModal');
            if (modal) modal.remove();
        }
        
        function toggleTransactionId() {
            const method = document.getElementById('paymentMethodSelect').value;
            const row = document.getElementById('transactionIdRow');
            row.style.display = (method === 'cash') ? 'none' : 'block';
        }
        
        async function addPayment() {
            const amount = parseFloat(document.getElementById('paymentAmount').value);
            const method = document.getElementById('paymentMethodSelect').value;
            const transactionId = document.getElementById('transactionId').value;
            const notes = document.getElementById('paymentNotes').value;
            
            console.log('üí≥ √ñdeme alƒ±nƒ±yor:', { amount, method, transactionId, notes });
            
            if (!amount || amount <= 0) {
                showNotification('L√ºtfen ge√ßerli bir tutar girin', 'error');
                return;
            }
            
            const remaining = parseFloat(document.getElementById('remainingAmount').textContent) || 0;
            if (amount > remaining) {
                showNotification('√ñdeme tutarƒ± kalan bor√ßtan fazla olamaz', 'error');
                return;
            }
            
            try {
                showLoading();
                
                const serviceId = getServiceId();
                const customerId = serviceData?.customer_id;
                
                console.log('üîÑ API √ßaƒürƒ±sƒ± yapƒ±lƒ±yor:', '/financial/payments');
                
                const result = await apiCall('/financial/payments', 'POST', {
                    service_id: serviceId,
                    customer_id: customerId,
                    amount,
                    payment_method: method,
                    transaction_id: transactionId || null,
                    status: 'completed',
                    notes
                });
                
                console.log('‚úÖ √ñdeme kaydedildi:', result);
                showNotification('√ñdeme ba≈üarƒ±yla kaydedildi', 'success');
                closePaymentModal();
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                console.error('‚ùå √ñdeme hatasƒ±:', error);
                showNotification('√ñdeme kaydedilemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // Photo Upload
        let allPhotos = [];
        let currentFilter = 'all';
        
        function openUploadModal() {
            const modal = document.createElement('div');
            modal.id = 'uploadModal';
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>üì§ Dosya Y√ºkle</h3>
                        <button class="close-btn" onclick="closeUploadModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-row">
                            <label>Kategori *</label>
                            <select id="fileCategory" required>
                                <option value="before">üî¥ Servis √ñncesi</option>
                                <option value="after">üü¢ Servis Sonrasƒ±</option>
                                <option value="part">üì¶ Par√ßa Fotoƒürafƒ±</option>
                                <option value="document">üìÑ Belge/Fatura</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Dosya Se√ß *</label>
                            <input type="file" id="fileInput" accept="image/*,.pdf" multiple required>
                            <small style="color: #64748b;">Desteklenen formatlar: JPG, PNG, PDF</small>
                        </div>
                        <div class="form-row">
                            <label>A√ßƒ±klama</label>
                            <textarea id="fileDescription" rows="2" placeholder="Dosya a√ßƒ±klamasƒ±..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeUploadModal()">ƒ∞ptal</button>
                        <button class="btn btn-primary" onclick="uploadFiles()">Y√ºkle</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeUploadModal() {
            const modal = document.getElementById('uploadModal');
            if (modal) modal.remove();
        }
        
        async function uploadFiles() {
            const category = document.getElementById('fileCategory').value;
            const files = document.getElementById('fileInput').files;
            const description = document.getElementById('fileDescription').value;
            
            console.log('üì∏ Dosya y√ºkleniyor:', { category, fileCount: files.length, description });
            
            if (!files || files.length === 0) {
                showNotification('L√ºtfen dosya se√ßin', 'error');
                return;
            }
            
            try {
                showLoading();
                const serviceId = getServiceId();
                const token = localStorage.getItem('authToken');
                
                console.log('üîÑ FormData hazƒ±rlanƒ±yor...');
                
                // FormData ile dosya g√∂nder
                const formData = new FormData();
                formData.append('category', category);
                formData.append('description', description);
                
                for (let i = 0; i < files.length; i++) {
                    formData.append('files', files[i]);
                    console.log(`üì§ Dosya ${i+1}/${files.length}:`, files[i].name);
                }
                
                // Fetch ile g√∂nder (apiCall FormData desteklemiyor)
                const response = await fetch(`${API_BASE_URL}/services/${serviceId}/files`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const result = await response.json();
                console.log('‚úÖ T√ºm dosyalar y√ºklendi:', result);
                
                showNotification(`${files.length} dosya ba≈üarƒ±yla y√ºklendi`, 'success');
                closeUploadModal();
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                console.error('‚ùå Dosya y√ºkleme hatasƒ±:', error);
                showNotification('Dosya y√ºklenemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
        
        function filterPhotos(category) {
            currentFilter = category;
            
            // Update button styles
            document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                btn.style.background = '';
                btn.style.color = '';
                btn.className = 'btn btn-secondary';
            });
            
            const activeBtn = document.getElementById(`filter-${category}`);
            activeBtn.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
            activeBtn.style.color = 'white';
            
            renderPhotos();
        }
        
        async function renderPhotos() {
            const gallery = document.getElementById('photoGallery');
            
            const filtered = currentFilter === 'all' 
                ? allPhotos 
                : allPhotos.filter(p => p.category === currentFilter);
            
            if (filtered.length === 0) {
                gallery.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #64748b; padding: 40px;">Bu kategoride fotoƒüraf yok</div>';
                return;
            }
            
            console.log('üì∏ Photos:', filtered);
            
            // Use direct file path from backend
            gallery.innerHTML = filtered.map(photo => {
                const description = (photo.description || 'A√ßƒ±klama yok').replace(/'/g, '&#39;');
                // API returns path column from database
                const imagePath = photo.path;
                const imageUrl = imagePath ? `${API_BASE_URL.replace('/api/v1', '')}${imagePath}` : '';
                return `
                <div style="position: relative; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer;" onclick="viewPhoto('${imageUrl}')">
                    <img src="${imageUrl}" style="width: 100%; height: 200px; object-fit: cover;">
                    <div style="position: absolute; top: 10px; right: 10px;">
                        <span class="status-badge status-completed" style="font-size: 11px;">${getCategoryLabel(photo.category)}</span>
                    </div>
                    <div style="padding: 12px; background: white;">
                        <div style="font-size: 13px; color: #64748b;">${new Date(photo.created_at).toLocaleDateString('tr-TR')}</div>
                        <div style="font-size: 14px; color: #1e293b; margin-top: 4px;">${description}</div>
                    </div>
                    <button onclick="event.stopPropagation(); deletePhoto(${photo.file_id})" style="position: absolute; bottom: 10px; right: 10px; background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
                        üóëÔ∏è Sil
                    </button>
                </div>
                `;
            }).join('');
        }
        
        function getCategoryLabel(category) {
            const labels = {
                before: 'üî¥ √ñncesi',
                after: 'üü¢ Sonrasƒ±',
                part: 'üì¶ Par√ßa',
                document: 'üìÑ Belge'
            };
            return labels[category] || category;
        }
        
        function viewPhoto(path) {
            // Lightbox modal
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.style.background = 'rgba(0,0,0,0.9)';
            modal.onclick = () => modal.remove();
            modal.innerHTML = `
                <div style="max-width: 90%; max-height: 90%; position: relative;">
                    <img src="${path}" style="max-width: 100%; max-height: 90vh; object-fit: contain;">
                    <button onclick="event.stopPropagation(); this.parentElement.parentElement.remove()" style="position: absolute; top: 20px; right: 20px; background: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 24px;">√ó</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        async function deletePhoto(fileId) {
            const confirmed = await customConfirm('Bu fotoƒürafƒ± silmek istediƒüinizden emin misiniz?');
            if (!confirmed) return;
            
            try {
                showLoading();
                
                // Backend endpoint √ßaƒürƒ±sƒ± (≈üimdilik sim√ºle et)
                // await apiCall(`/files/${fileId}`, 'DELETE');
                
                showNotification('Fotoƒüraf silindi (Backend entegrasyonu bekleniyor)', 'success');
                
                // Sayfayƒ± yenile
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                showNotification('Fotoƒüraf silinemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        // Edit Service
        function editService() {
            if (!serviceData) return;
            
            const modal = document.createElement('div');
            modal.id = 'editServiceModal';
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h3>‚úèÔ∏è Servis D√ºzenle</h3>
                        <button class="close-btn" onclick="closeEditServiceModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-row">
                            <label>Durum *</label>
                            <select id="editStatus" required>
                                <option value="pending" ${serviceData.status === 'pending' ? 'selected' : ''}>Beklemede</option>
                                <option value="in_progress" ${serviceData.status === 'in_progress' ? 'selected' : ''}>Devam Ediyor</option>
                                <option value="completed" ${serviceData.status === 'completed' ? 'selected' : ''}>Tamamlandƒ±</option>
                                <option value="cancelled" ${serviceData.status === 'cancelled' ? 'selected' : ''}>ƒ∞ptal</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label>Planlanan Tarih</label>
                            <input type="datetime-local" id="editScheduledDate" value="${serviceData.scheduled_date ? new Date(serviceData.scheduled_date).toISOString().slice(0,16) : ''}">
                        </div>
                        <div class="form-row">
                            <label>≈ûikayet/Talep</label>
                            <textarea id="editDescription" rows="3">${serviceData.problem_description || ''}</textarea>
                        </div>
                        <div class="form-row">
                            <label>Te≈ühis</label>
                            <textarea id="editDiagnosis" rows="3">${serviceData.diagnosis || ''}</textarea>
                        </div>
                        <div class="form-row">
                            <label>Yapƒ±lan ƒ∞≈ülemler</label>
                            <textarea id="editWorkDone" rows="3">${serviceData.work_done || ''}</textarea>
                        </div>
                        <div class="form-row">
                            <label>ƒ∞≈ü√ßilik √úcreti (‚Ç∫)</label>
                            <input type="number" id="editLaborCost" step="0.01" value="${serviceData.labor_cost || 0}">
                        </div>
                        <div class="form-row">
                            <label>Yol √úcreti (‚Ç∫)</label>
                            <input type="number" id="editTravelCost" step="0.01" value="${serviceData.travel_cost || 0}">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeEditServiceModal()">ƒ∞ptal</button>
                        <button class="btn btn-primary" onclick="saveServiceEdit()">Kaydet</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function closeEditServiceModal() {
            const modal = document.getElementById('editServiceModal');
            if (modal) modal.remove();
        }
        
        async function saveServiceEdit() {
            const serviceId = getServiceId();
            
            const updateData = {
                status: document.getElementById('editStatus').value,
                scheduled_date: document.getElementById('editScheduledDate').value || null,
                problem_description: document.getElementById('editDescription').value,
                diagnosis: document.getElementById('editDiagnosis').value,
                work_done: document.getElementById('editWorkDone').value,
                labor_cost: parseFloat(document.getElementById('editLaborCost').value) || 0,
                travel_cost: parseFloat(document.getElementById('editTravelCost').value) || 0
            };
            
            // Auto-set completion date if status is completed
            if (updateData.status === 'completed' && !serviceData.completion_date) {
                updateData.completion_date = new Date().toISOString();
            }
            
            try {
                showLoading();
                
                await apiCall(`/services/${serviceId}`, 'PUT', updateData);
                
                showNotification('Servis ba≈üarƒ±yla g√ºncellendi', 'success');
                closeEditServiceModal();
                
                // Sayfayƒ± yenile
                setTimeout(() => location.reload(), 1000);
                
            } catch (error) {
                showNotification('Servis g√ºncellenemedi: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }
    </script>
</body>
</html>
